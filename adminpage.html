<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>
  </head>
  <style>
    body {
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin-left: 10px;
    }
    .wrapper {
      margin-left: 250;
      position: relative;
      width: 1200px;
      height: 300px;
      margin-bottom: 300px;
      background: transparent;
    }

    /* Entire form */

    .form-lgn {
      border: 2px solid white;
      border-radius: 20px;
      width: 900px;
      height: 400px;
      position: absolute;
      margin-left: 250px;
      margin-top: 50px;
      background: #fa469a;
      color: white;
    }
    .form-lgn h1 {
      margin-left: 150px;
      margin-top: 15px;
      font-size: 40px;
    }

    /* login  inside button */

    .btn2 {
      margin-top: 10px;
      background: white;
      border-radius: 3px;
      width: 80px;
      height: 40px;
      margin-left: 50px;
      border: 2px solid #f92288;
    }
    .btn2:hover {
      transform: scale(1.1);
      background: white;
      color: #f92288;
      border: 2px solid rgb(207, 205, 207);
      border-radius: 3px;
    }

    /* login outside button */

    .btn3 {
      margin-top: 10px;
      border-radius: 3px;
      width: 80px;
      height: 35px;
      margin-left: 100px;
      color: #fff;
      background: #ff3091;
      border: 1px solid #ff3091;
    }
    .btn3:hover {
      transform: scale(1.1);
      color: #f92288;
      background: white;
    }
    .img img {
      margin-left: 100px;
      float: right;
      width: 450px;
      height: 400px;
      border-radius: 15px;
      background: rgb(174, 173, 174);
    }
    .img {
      margin-top: 0px;
    }
    .input-box {
      margin-left: 50px;
      margin-top: 80px;
    }
    .input-box label {
      font-family: Arial;
      font-weight: bold;
      color: white;
    }
    .b1 {
      margin-left: 130px;
      margin-top: 10px;
    }
    .b2 {
      margin-top: 30px;
      margin-left: 1000px;
    }

    /* desgnin the icons */

    .input-box ion-icon {
      color: white;
      font-size: 18px;
    }

    .input-box input {
      border-radius: 3px;
      border: 1px solid #fa469a;
      margin-left: 10px;
      outline: none;
      display: inline-block;
      height: 30px;
      width: 180px;
    }
    .link {
      margin-top: 130px;
    }
    .link a {
      text-decoration: none;
      font-size: 18px;
      color: white;
    }
  </style>

  <body>
    <!---login btn----->
    <form action="loginpage" method="GET">
      <!---THIS ACTION GET  FROM login  PAge---->
      <div class="b2">
        <input type="submit" value="Login" class="btn3" />
      </div>
    </form>
    <div class="wrapper">
      <div class="form-lgn">
        <div class="img">
          <img src="images/admin.png" />
        </div>
        <h1>Admin</h1>
        <!-------
Neenga action="/adminpage" kuduthirukinga ‚Üí ‡Æá‡Æ§‡ØÅ backend (server) iruntha thaan work aagum.
Aana unga project fulla Firebase + HTML frontend mattum dhan.
So action use panna navigation nadakkaadhu.
Neenga just adminpage.html open aaganum nu sollreenga. Appo direct ah .html file path kudukanum.

-->
        <form action="adminpage.html" id="f2" POST>
          <div class="input-box">
            <label>Username <ion-icon name="person"></ion-icon></label>
            <input type="text" name="ad_name" required id="adnme" /><br /><br />
            <label>Password <ion-icon name="lock-closed"></ion-icon> </label>
            <input type="password" name="ad_pass" required id="adpwd" /> <br />
          </div>
          <div class="b1">
            <input type="submit" value="Login" class="btn2" />
          </div>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="module">
      /*antha link */
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        child,
        get,
      } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

      const crudstting = {
        databaseURL: "https://finalyrsprjct-default-rtdb.firebaseio.com/",
      };

      const app = initializeApp(crudstting);
      const db = getDatabase(app);
      const dbRef = ref(db);

      const adname = document.querySelector("#adnme");
      const adpword = document.querySelector("#adpwd");
      const admfrm = document.querySelector("#f2");

      // ‚úÖ async added here
      // Validation null check await = DB la irunthu result vara wait pannum keyword.
      //Admin login ku mattum illa, yentha DB operation pannaalum use panna vendum.
      /*Firebase la admntbl fetch panrom.

          Data iruka nu check panrom.
          For loop la ellarum (admin1, admin2, ‚Ä¶) iterate panrom.
          Enter pannra username/password match aana ‚Üí success.
          Match illa ‚Üí invalid.
          Error/empty table na ‚Üí alert.*/
      // db stcrture romba important
      admfrm.addEventListener("submit", async function (e) {
        e.preventDefault();

        let username = adname.value.trim();
        let password = adpword.value.trim();

        try {
          const snapshot = await get(child(dbRef, "admntbl"));
          if (snapshot.exists()) {
            let data = snapshot.val();
            let isValid = false;

            // üî• Loop through all admins
            for (let key in data) {
              if (
                data[key].adminname === username &&
                data[key].adminpwd === password
              ) {
                isValid = true;
                break;
              }
            }

            if (isValid) {
              Swal.fire("‚úÖ Success", "Admin Login Successful", "success");
              setTimeout(() => {
                window.location.href = "admindashboard.html";
              }, 1500);
            } else {
              Swal.fire("‚ùå Failed", "Invalid Username or Password", "error");
            }
          } else {
            Swal.fire("‚ö†Ô∏è Error", "No admin data found", "warning");
          }
        } catch (error) {
          Swal.fire("‚ö†Ô∏è Error", error.message, "error");
        }
      });
    </script>
  </body>
</html>
